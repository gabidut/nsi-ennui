<!doctype html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>Login plz</title>

    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

</head>

<body>
    <section class="spans"> <span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span><span class="bg"></span><span class="bg"></span><span class="bg"></span><span
            class="bg"></span>
        <div class="signin">
            <div class="content">
                <div class="fixed-user">
                    <span class="material-symbols-outlined">account_circle</span>
                    <p>
                        <%= req.session.user %>
                    </p>
                </div>
                <% if (req.session.user === "admin") { %>
                    <div class="fixed-admin">
                        <span class="material-symbols-outlined" style="color: red; cursor: pointer;"
                            onclick="socket.emit('admin prof');">admin_panel_settings</span>
                    </div>
                <% } %>
                <div class="scisor">
                    <div class="games">
                        <div class="games-input">
                            <input type="text" id="game-text" style="width: 75%; height: 100%;"><input type="button"
                                style="width: 25%; height: 100%;" value="Envoyer le lien du jeu" id="game-send">
                        </div>
                        <div class="game-list">
                            <% for (game in games) { %>
                                <div class="game" link="<%= games[game].link %>">
                                    <p class="game-name"><%= games[game].name %></p>
                                    <img src="<%= games[game].icon %>" alt="" class="img">
                                    <span link="<%= games[game].link %>" class="join">REJOINDRE</span>
                                    <span class="material-symbols-outlined" style="color: red; cursor: pointer;"
                                        onclick="socket.emit('game delete', `<%= games[game].link %>`);">delete</span>

                                </div>
                            <% } %>
                        </div>
                    </div>
                    <div class="vdivider"></div>
                    <div class="chat">
                        <div class="chat-logs">
                            <p class="logged">CHAT CONNECTÉ!</p>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="msg-text" style="width: 75%; height: 100%;"><input type="button"  style="width: 25%; height: 100%;" value="Envoyer" id="msg-send">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
</html>

<script src="/socket.io/socket.io.js"></script>

<script>
    const socket = io();

    // chat
    const msgText = document.getElementById("msg-text");
    const msgSend = document.getElementById("msg-send");

    msgSend.onclick = () => {
        if (msgText.value.trim() !== "") {
            socket.emit("chat message", msgText.value);
            msgText.value = "";
        }
    }

    msgText.onkeydown = (e) => {
        if (e.key === "Enter") {
            if (msgText.value.trim() !== "") {
                socket.emit("chat message", msgText.value);
                msgText.value = "";
            }
        }
    }

    socket.on("chat message", (msg) => {
        const chatLogs = document.querySelector(".chat-logs");
        const chatLog = document.createElement("p");
        chatLog.classList.add("chatlog");
        chatLog.innerText = msg;
        chatLogs.appendChild(chatLog);
    });

    socket.on("chat admin", (msg) => {
        const chatLogs = document.querySelector(".chat-logs");
        const chatLog = document.createElement("p");
        chatLog.style.color = "red"
        chatLog.classList.add("chatlog");
        chatLog.innerText = msg;
        chatLogs.appendChild(chatLog);
    });

    const gameText = document.getElementById("game-text");
    const gameSend = document.getElementById("game-send");

    gameSend.onclick = () => {
        if (gameText.value.trim() !== "") {
            socket.emit("game link", gameText.value);
            gameText.value = "";
        }
    }

    gameText.onkeydown = (e) => {
        if (e.key === "Enter") {
            if (gameText.value.trim() !== "") {
                socket.emit("game link", gameText.value);
                gameText.value = "";
            }
        }
    }

    socket.on("game link", (msg) => {
        const chatLogs = document.querySelector(".chat-logs");
        const chatLog = document.createElement("p");
        chatLog.style.color = "yellow"
        chatLog.classList.add("chatlog");
        chatLog.innerText = "[NOUVEAU JEU] " + msg["link"];
        chatLogs.appendChild(chatLog);

        const gameList = document.querySelector(".game-list");
        const game = document.createElement("div");
        game.classList.add("game");
        game.setAttribute("link", msg["link"]);
        const gameName = document.createElement("p");
        gameName.classList.add("game-name");
        gameName.innerText = msg["name"];
        const img = document.createElement("img");
        img.src = msg["icon"];
        img.alt = "";
        img.classList.add("img");
        const join = document.createElement("span");
        join.setAttribute("link", msg["link"]);
        join.classList.add("join");
        join.innerText = "REJOINDRE";
        game.appendChild(gameName);
        game.appendChild(img);
        game.appendChild(join);
        gameList.appendChild(game);

        // dlete icon
        const deleteIcon = document.createElement("span");
        deleteIcon.classList.add("material-symbols-outlined");
        deleteIcon.innerText = "delete";
        deleteIcon.style.color = "red";
        deleteIcon.style.cursor = "pointer";
        deleteIcon.onclick = () => {
            socket.emit("game delete", msg.link);
        }
        game.appendChild(deleteIcon);


    });

    socket.on('game delete', (msg) => {
        const chatLogs = document.querySelector(".chat-logs");
        const chatLog = document.createElement("p");
        chatLog.style.color = "yellow"
        chatLog.classList.add("chatlog");
        chatLog.innerText = "[JEU SUPPRIMÉ] " + msg;
        chatLogs.appendChild(chatLog);

        const gameList = document.querySelector(".game-list");
        const games = gameList.querySelectorAll(".game");
        for (let i = 0; i < games.length; i++) {
            if (games[i].getAttribute("link") === msg) {
                gameList.removeChild(games[i]);
            }
        }
    });

    document.addEventListener("click", (e) => {
        if (e.target.classList.contains("join")) {
            window.open(e.target.getAttribute("link"), "_blank");
        }
    });

    socket.on("admin prof", () => {
        const chatLogs = document.querySelector(".chat-logs");
        chatLogs.innerHTML = "";
        const gameList = document.querySelector(".game-list");
        gameList.innerHTML = "";
        window.open("https://m-co.lesformateurslibres.fr/mod/forum/view.php?id=18262", "_blank", "fullscreen=yes");

    });

</script>